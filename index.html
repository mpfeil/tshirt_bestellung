<!doctype html>
<html ng-app="shirtApp">
<head>
<meta charset="utf-8">
<title>T-Shirt Bestellliste</title>
<script src="bower_components/jquery/jquery.min.js"></script>
<script src="bower_components/angular/angular.js"></script>
<script src="bower_components/ngstorage/ngStorage.js"></script>
<script src="bower_components/angular-xeditable/dist/js/xeditable.js"></script>
<script src="json2csv.js"></script>
<link href="bower_components/angular-xeditable/dist/css/xeditable.css" rel="stylesheet">
<style type="text/css">
#tab {
  width: 56%;
  margin-left: 44%;
}

div#form {
  float: left;
  width: 44%;
}

table {
  width: 100%;
}

div.field, div.actions {
  margin-bottom: 10px;
  text-align: center;
  vertical-align: middle;
}

input.form-input {
  height: 1.3em;
  font-size: 1.2em;
}

button.form-input {
  margin-top: 0.5em;
  height: 2em;
  font-size: 1.2em;
}

input[type="radio"] {
  display: none;
}

.radio_label {
  display: inline-block;
  height: 25px;
  width: 100px;
  vertical-align: middle;
  background-color: lightgrey;
  border: 3px solid transparent;
  -moz-user-select: none;
  user-select: none;
  -webkit-user-select: none;
}

.selector_label {
  width: 25px;
}

.shirt {
  display: inline-block;
  padding-top:20px;
  height: 240px;
  width: 200px;
  float: left;
}

.shirt_text {
  color: white;
  margin-top: -40px;
  font-size: 16pt;
}

.shirt_text:before {
  content: attr(data-study);
}

.selector_container {
  height: 260px;
  width: 75px;
  float: left;
}

@font-face {
  font-family: globusFont;
  src: url('globus_font.ttf');
}

.globus {
  display:inline;
  font-family: globusFont;
  font-size: 200px;
  color: white;
  margin-top: 20px;
}

input[type="radio"]:checked + label {
  border: 3px solid red;
  font-weight: bold;
}

input[type="radio"]:disabled + label {
  color: grey;
  background-color: lightgrey;
}

.GEO {
  background-color: orange;
}

.GI {
  background-color: #336699;
}

.LÖK {
  background-color: green;
}

.Black {
  background-color: black;
}

.Herren {
  background-color: cornflowerblue;
}

.Damen {
  background-color: lightcoral;
}

.CityGreen {
  background-color: forestgreen;
}

.Navy {
  background-color: navy;
}

.RiverBlue {
  background-color: cornflowerblue;
}

.Chocolate {
  background-color: chocolate;
}

.Red {
  background-color: red;
}

.White {
  background-color: ghostwhite;
}

.Natural {
  background-color: wheat;
}

label.NeonGrün {
  background-color: yellowgreen;
}

p.NeonGrün {
  color: yellowgreen;
}

label.NeonPink {
  background-color: deeppink;
}

p.NeonPink {
  color: deeppink;
}

label.Blau {
  background-color: steelblue;
}

p.Blau {
  color: steelblue;
}

label.Hellblau {
  background-color: skyblue;
}

p.Hellblau {
  color: skyblue;
}

label.NeonGelb {
  background-color: yellow;
}

p.NeonGelb {
  color: yellow;
}

label.Gelb {
 background-color: gold;
}

p.Gelb {
  color: gold;
}

label.Beige {
  background-color: darkgoldenrod;
}

p.Beige {
  color: darkgoldenrod;
}

label.Kackbraun {
  background-color: saddlebrown;
}

p.Kackbraun {
  color: saddlebrown;
}

label.Orange {
 background-color: darkorange;
}

p.Orange {
  color: darkorange;
}

label.NeonOrange {
  background-color: orange;
}

p.NeonOrange {
  color: orange;
}

label.Weiss {
  background-color: ghostwhite;
}

p.Weiss {
  color: ghostwhite;
}

label.Schwarz {
  background-color: black;
}

p.Schwarz {
  color: black;
}

label.Rot {
  background-color: red;
}

p.Rot {
  color: red;
}

label.Lila {
  background-color: darkorchid;
}

p.Lila {
  color: darkorchid;
}

label.Türkis {
  background-color: cyan;
}

p.Türkis {
  color: cyan;
}

label.Grün {
  background-color: darkgreen;
}

p.Grün {
  color: darkgreen;
}

td.tabhead {
  font-weight: bold;
  background-color: lightgrey;
}

tr.tabhead {
  background-color: lightgrey;
  border-bottom: 2px solid black;
}
</style>
<script type="text/javascript">
  angular.module('shirtApp', ['ngStorage', 'xeditable']).controller('ShirtCtrl',function($scope,$localStorage) {
    $scope.$storage = $localStorage.$default({
      shirts: []
    });

    $scope.studies = [
      "GEO",
      "GI",
      "LÖK"
    ];

    $scope.gender = [
      "Herren",
      "Damen"
    ];

    $scope.sizes = [
      "XXL",
      "XL",
      "L",
      "M",
      "S"
    ];

    $scope.colors = [
      "Black",
      "White",
      "Natural",
      "Navy",
      "RiverBlue",
      "Chocolate",
      "Red",
      "CityGreen"
    ];

    $scope.prints = [
      "Weiß",
      "NeonGrün",
      "Rot",
      "NeonPink",
      "Blau",
      "Hellblau",
      "NeonGelb",
      "Gelb",
      "Beige",
      "Schwarz",
      "Kackbraun",
      "Orange",
      "NeonOrange",
      "Lila",
      "Türkis",
      "Grün"
    ];

    $scope.master = {
      shirtName:        '',
      shirtEmail:       '',
      shirtAnzahl:      1,
      shirtStudiengang: '',
      shirtGeschlecht:  '',
      shirtGroesse:     '',
      shirtFarbe:       '',
      shirtAufdruck:    ''
    };

    $scope.deleteShirts = function() {
      delete $localStorage.shirts;
    };

    $scope.deleteShirt = function(shirt) {
      if (window.confirm("Wirklich dieses Shirt löschen?")) {
        if ($scope.$storage.shirts.indexOf(shirt) != -1) {
          $scope.$storage.shirts.splice($scope.$storage.shirts.indexOf(shirt), 1);
        }
      }
    };

    $scope.femaleSelected = function() {
      return ($scope.shirt.shirtGeschlecht === 'Damen' ? true : false);
    };

    $scope.bigN = function(what) {
      return (what.indexOf("Neon") != -1 ? "N" : "");
    };

    $scope.addShirt = function() {
      $scope.$storage.shirts.push({
        name:         $scope.shirt.shirtName,
        email:        $scope.shirt.shirtEmail,
        anzahl:       $scope.shirt.shirtAnzahl,
        studiengang:  $scope.shirt.shirtStudiengang,
        geschlecht:   $scope.shirt.shirtGeschlecht,
        groesse:      $scope.shirt.shirtGroesse,
        farbe:        $scope.shirt.shirtFarbe,
        aufdruck:     $scope.shirt.shirtAufdruck
      });
      $scope.reset();
    };

    $scope.reset = function() {
      $scope.shirt = angular.copy($scope.master);
    };

    $scope.isUnchanged = function(shirt) {
      return angular.equals(shirt, $scope.master);
    };

    $scope.download = function() {
      var jsonexport = [];
      angular.copy($scope.$storage.shirts, jsonexport);
      var geo_csv = json2csv(jsonexport.filter( function(obj) { return obj.studiengang == 'GEO' } ));
      var gi_csv = json2csv(jsonexport.filter( function(obj) { return obj.studiengang == 'GI' } ));
      var lok_csv = json2csv(jsonexport.filter( function(obj) { return obj.studiengang == 'LÖK' } ));
      window.open("data:text/csv;charset=utf-8," + escape(geo_csv), 'shirts_geo.csv');
      window.open("data:text/csv;charset=utf-8," + escape(gi_csv), 'shirts_gi.csv');
      window.open("data:text/csv;charset=utf-8," + escape(lok_csv), 'shirts_loek.csv');
    };

    $scope.reset();
  });
  window.onbeforeunload = function() {
   //return false;
  };
</script>
</head>
<body ng-controller="ShirtCtrl">
<div id="form">
<form accept-charset="UTF-8" name="form" novalidate>
  <div class="field">
    <input class="form-input" placeholder="Name" type="text" ng-model="shirt.shirtName" required />
  </div>
  <div class="field">
    <input class="form-input" placeholder="E-Mail" type="email" ng-model="shirt.shirtEmail" required />
  </div>
  <div class="field">
    <label for="shirt_anzahl">Anzahl</label><br />
    <input class="form-input" type="number" min="1" ng-model="shirt.shirtAnzahl" />
  </div>
  <div class="field">
    <span ng-repeat="study in studies">
      <input id="shirt_studiengang_{{study}}" type="radio" value="{{study}}" ng-model="shirt.shirtStudiengang" />
      <label class="radio_label {{study}}" for="shirt_studiengang_{{study}}">{{study}}</label>
    </span>
    <input type="hidden" ng-model="shirt.shirtStudiengang" required />
  </div>
  <div class="field">
    <span ng-repeat="gen in gender">
      <input id="shirt_geschlecht_{{gen}}" type="radio" value="{{gen}}" ng-model="shirt.shirtGeschlecht" />
      <label class="radio_label {{gen}}" for="shirt_geschlecht_{{gen}}">{{gen}}</label>
    </span>
    <input type="hidden" ng-model="shirt.shirtGeschlecht" required>
  </div>
  <div class="field">
    <span ng-repeat="size in sizes">
      <input id="shirt_groesse_{{size}}" type="radio" value="{{size}}" ng-model="shirt.shirtGroesse" />
      <label class="radio_label" for="shirt_groesse_{{size}}">{{size}}</label>
    </span>
    <input type="hidden" ng-model="shirt.shirtGroesse" required>
  </div>
  <div class="field preview">
    <div class="selector_container" style="margin-left:18%;">
      <span ng-repeat="color in colors">
        <input id="shirt_farbe_{{color}}" type="radio" value="{{color}}" ng-model="shirt.shirtFarbe" />
        <label class="radio_label selector_label {{color}}" for="shirt_farbe_{{color}}" title="{{color}}"></label>
      </span>
      <input type="hidden" ng-model="shirt.shirtFarbe" required>
    </div>
    <div class="shirt" ng-class="shirt.shirtFarbe">
      <p class="globus" ng-class="shirt.shirtAufdruck">g</p>
      <p class="shirt_text" data-study="{{shirt.shirtStudiengang.toLowerCase()}}" ng-class="shirt.shirtAufdruck"> | münster</p>
    </div>
    <div class="selector_container">
      <span ng-repeat="print in prints">
        <input id="shirt_aufdruck_{{print}}" type="radio" value="{{print}}" ng-model="shirt.shirtAufdruck" />
        <label class="radio_label selector_label {{print}}" for="shirt_aufdruck_{{print}}" title="{{print}}">{{bigN(print)}}</label>
      </span>
      <input type="hidden" ng-model="shirt.shirtAufdruck" required>
    </div>
  </div>
  <div class="actions">
    Shirt: {{shirt.shirtFarbe}}<br />Aufdruck: {{shirt.shirtAufdruck}}
    <input type="reset" />
    <button class="form-input" ng-click="addShirt()" ng-disabled="form.$invalid || isUnchanged(shirt)">Neue Bestellung</button>
  </div>

</form>
</div>
<div id="tab">
  <a ng-click="download()" href="#">Daten herunterladen</a>
  <table>
    <tbody>
      <tr class="tabhead">
        <td>&nbsp;</td>
        <td>Name</td>
        <td>E-Mail</td>
        <td>Anzahl</td>
        <td>Studiengang</td>
        <td>Geschlecht</td>
        <td>Größe</td>
        <td>Farbe</td>
        <td>Aufdruck</td>
      </tr>
      <tr ng-repeat="shirt in $storage.shirts | orderBy:'studiengang'">
        <td><a ng-click="deleteShirt(shirt)" href="#">&times;</a></td>
        <td><a href="#" e-required editable-text="shirt.name" buttons="no">{{ shirt.name }}</a></td>
        <td><a href="#" e-required editable-text="shirt.email" buttons="no">{{ shirt.email }}</a></td>
        <td><a href="#" e-required editable-text="shirt.anzahl" buttons="no" e-min="1">{{ shirt.anzahl }}</a></td>
        <td><a href="#" e-required editable-select="shirt.studiengang" e-ng-options="s for s in studies" buttons="no">{{ shirt.studiengang }}</a></td>
        <td><a href="#" e-required editable-select="shirt.geschlecht" e-ng-options="g for g in gender" buttons="no">{{ shirt.geschlecht }}</a></td>
        <td><a href="#" e-required editable-select="shirt.groesse" e-ng-options="s for s in sizes" buttons="no">{{ shirt.groesse }}</a></td>
        <td><a href="#" e-required editable-select="shirt.farbe" e-ng-options="f for f in colors" buttons="no">{{ shirt.farbe }}</a></td>
        <td><a href="#" e-required editable-select="shirt.aufdruck" e-ng-options="p for p in prints" buttons="no">{{ shirt.aufdruck }}</a></td>
      </tr>
    </tbody>
  </table>
  <a ng-click="deleteShirts()" href="#">Alle löschen</a>
</div>

</body>
</html>
